{% load static %}
<!DOCTYPE html>
<html>
<body class='layout-default'>
	{% include 'common/header.html' %}

	
	<div id='welcomeBanner'>
		<section class='hero main_hero is-fullheight'>
			<div class='hero-body'>
				<div class='has-text-centered; slider-content animated zoomIn'>
					<div>
						<p class='title is-1 main-text'>Welcome to GIMME-Web, {{request.session.fullName}}</p>
						<p class='subtitle is-4 main-text'>A Sophisticated Group Interactions Management Tool</p>
					</div>
				</div>
			</div>
		</section>
	</div>
	
	{% if debug %}
	<div id='dashboard'>
		<section class='section' style="position: relative; z-index: 1000">
			<div class='panel animated zoomIn'>
				<div class='panel-heading'>
					<div class='columns is-mobile is-vcentered'>
						<div class='column'>
							Simulations
							<div class='is-pulled-right'>
								<div class='button minimizerButton'></div>
							</div>
						</div>
					</div>
				</div>
				<div class='panel-block'>
					<div class='column is-half is-offset1 is-mobile'>
						<div class='dash-cell-box'>
							<div class='subtitle is-5 has-tooltip-arrow' style='color:gray;' data-tooltip='placeholder'>Dashboard</div>
							<p>Simulation State</p>
							<div class='columns is-mobile is-centered is-mobile'>
								<div class='column is-7' id='simulationState_professor_dash'></div>
							</div>
							<div class='button' id='advanceSimulationButton_professor_dash'> Advance Simulation</div>
							<div class='button' id='resetSimulationButton_professor_dash'> Reset Simulation</div>

						</div>
					</div>
					<div class='column is-half is-offset1 is-mobile'>
						<div class='dash-cell-box' style="overflow: visible;">
							<div class='subtitle is-5 has-tooltip-arrow' style='color:gray;' data-tooltip='placeholder'>Storyline</div>
							<div class='columns is-mobile is-multiline is-mobile'>
								<div class='column'>
								<div class='table' style='margin:2em;' id='storylineLog_professor_dash'>
									<div id="simulationLog_professor_dash">

									</div>
									<div class="dropdown">
										<div class="dropdown-trigger">
											<button class='button' aria-haspopup='true' aria-controls='dropdownMenu1'>
												<span>
													Simulation Actions
												</span>
												<span class='icon is-small' >
													<i class='fas fa-angle-down' aria-hidden='true'></i>
												</span>
											</button>
										</div>
										<div id="simulationAction_professor_dash">

										</div>

									</div>
								</div>
								</div>
							</div>
						</div>
					</div>
				</div>				
		</section>
		
		{% endif %}


		<section class='section danger'>
			<div class='panel animated zoomIn'>
				<div class='panel-heading'>
					<div class='columns is-mobile is-vcentered'>
						<div class='column'>
							Students Setup
							<div class='is-pulled-right'>
								<div class='button minimizerButton'></div>
							</div>
						</div>
					</div>
				</div>
				<div class='panel-block'>
					<div class='column is-half is-offset1 is-mobile'>
						<div class='dash-cell-box'>
							<div class='subtitle is-5 has-tooltip-arrow' style='color:gray;' data-tooltip='These are the students, selected from all available students, to be considered for the next group management iteration.'>Free Students</div>
							<div class='table-container'>
								<div class='table' style='margin:2em;' id='freeUsersTable_professor_dash'></div>
							</div>
						</div>
					</div>
					<div class='column is-half is-offset1 is-mobile'>
						<div class='dash-cell-box'>
							<div class='subtitle is-5 has-tooltip-arrow' style='color:gray;' data-tooltip='These are the students, selected from all available students, to be considered for the next group management iteration.'>Selected Students</div>
							<div class='table-container'>
								<div class='table' style='margin:2em;' id='selectedUsersTable_professor_dash'></div>
							</div>
						</div>
					</div>
				</div>
				<div class='panel-block'>
					<div class='column is-offset-5'>
						<div class='button' type='submit' id='addSpecificPlayer_professor_dash'>Add specific player</div>
					</div>
					<div class='column is-offset-1'>
						<div class='button' type='submit' id='addAllUsers_professor_dash'>Select all</div>
					</div>
					<div class='column is-offset-1'>
						<div class='button' type='submit' id='clearAllUsers_professor_dash'>Deselect all</div>
					</div>
				</div>

			
			</div>
		</section>

		<section class='section'>
			<div class='panel animated zoomIn'>
				<div class='panel-heading'>
					<div class='columns is-mobile is-vcentered'>
						<div class='column'>
							Tasks Setup
							<div class='is-pulled-right'>
								<div class='button minimizerButton'></div>
							</div>
						</div>
					</div>
				</div>
				<div class='panel-block'>
					<div class='columns'>
						<div class='column is-half is-offset1 is-mobile'>
							<div class='dash-cell-box'>
								<div class='subtitle is-5' style='color:gray;'>Free Tasks</div>
								<div class='table-container'>
									<div class='table' style='margin:2em;' id='freeTasksTable_professor_dash'>
									</div>
								</div>
							</div>
						</div>
						<div class='column is-half is-offset1 is-mobile'>
							<div class='dash-cell-box'>
								<div class='subtitle is-4 has-tooltip-arrow' style='color:gray;' data-tooltip='These are the tasks, selected from all available tasks, to be considered for the next group management iteration.'>Selected Tasks</div>
								<div class='table-container'>
									<div class='table' style='margin:2em;' id='selectedTasksTable_professor_dash'></div>
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class='panel-block'>
					<div class='column is-offset-5'></div>
					<div class='column is-offset-1'>
						<div class='button' type='submit' id='addAllTasks_professor_dash'>Select all</div>
					</div>
					<div class='column is-offset-1'>
						<div class='button' type='submit' id='clearAllTasks_professor_dash'>Deselect all</div>
					</div>
				</div>
			</div>
		</section>



		<section class='section'>
			<div class='panel animated zoomIn'>
				<div class='panel-heading'>
					<div class='columns is-mobile is-vcentered'>
						<div class='column'>
							Adaptation Setup
							<div class='is-pulled-right'>
								<div class='button minimizerButton'></div>
							</div>
						</div>
						<!-- <div class='is-pulled-left'>
							<button class='button has-tooltip' id='toggleAdditionalConfigs_professor_dash' data-tooltip="Toggles additional algorithm selectors.">
								<i class="fa fa-bar-chart" aria-hidden="true"></i>
							</button>
						</div>
						<div class='is-pulled-left'>
							<p>â€‚</p>
						</div> -->
					</div>
				</div>
				

				<div class='panel-block' style='display: block;'>
					<div class='columns is-mobile is-multiline is-mobile is-centered'>

						<!-- <div class='column is-5 columns is-mobile is-multiline is-mobile'>
							<div class='column is-half'>
								<label id='mgsInput_professor_dash' class='control-label' for='quantity' min='2'>Min Group Size</label>  
								<div class='control'>
									<input id='minNumberOfPlayersPerGroupId_professor_dash' class='input' type='number' min='2' max='100' placeholder='2'>
								</div>
							</div>
							<div class='column is-half'>
								<label class='control-label' for='quantity'>Max Group Size</label>  
								<div class='control'>
									<input id='maxNumberOfPlayersPerGroupId_professor_dash' class='input' type='number' min='3' max='100' placeholder='4'>
								</div>
							</div>
						</div>
						<div class='column is-2 has-text-centered'>
							<p>OR</p>
						</div>-->

						<div class='column is-3'>
							<!-- <p>Groups</p> -->
							
							<div class='has-tooltip-arrow' data-tooltip='Sets the preferred amount of students per group.'>
								<label class='control-label' for='quantity'>Preferred Group Size</label>  
								<div class='control'>
									<input id='preferredNumberOfPlayersPerGroupId_professor_dash' class='input' type='number' min='2' max='100' placeholder='4'>
								</div>
							</div>
						</div>

						<div class='column is-3'>
						</div>

						<div class='column is-3'>
							<!-- <p>Students</p> -->
						
							<div class='has-tooltip-arrow' data-tooltip="Sets the amount of stored past states, for when taking a decision about a student's group. This will only take effect whenever player states are updated.">
								<label class='control-label' for='quantity'>Students Past Models Window</label>  
								<div class='control'>
									<input id='playerWindowId_professor_dash' class='input' type='number' min='2' max='100' placeholder='10'>
								</div>
							</div>
						</div>

					</div>

				</div>



				<div class='panel-block' style='display: block;'>
					<div class='columns is-mobile is-multiline is-mobile  has-tooltip-arrow' data-tooltip='This feature is optional, and still does not function as it should.'>
						<div class='column is-full'>
							<p>Bootstrap</p>
						</div>
						
						<div class='column is-half'>
							<label class='checkbox'>
							  <input id='precomputeBootstrapId_professor_dash' type='checkbox'>
							  	Pre-Compute Bootstrap
							</label>
						</div>

						<div class='column is-half'>
							<label class='field control-label' for='textinput'>Number of Bootstrap Iterations</label>  
							<div class='field control'>
								<input id='numBootstrapIterationsId_professor_dash' class='input' type='number' min='20' max='100' placeholder='20'>
							</div>
						</div>
						
					</div>
				</div>

			</div>
		</section>


		<section class='section' style='position: relative; z-index:10000'>
			<div class='panel animated zoomIn'>
				<div class='panel-heading'>
					<div class='columns is-mobile is-vcentered'>
						<div class='column'>
							Additional Adaptation Parameters
							<div class='is-pulled-right'>
								<button class='button minimizerButton' id='additionalAdaptMinimizerButton_professor_dash'></button>
							</div>
						</div>
					</div>
				</div>
		
				<!-- starts hidden -->
				<div class='panel-block' id='additionalAlgorithmsSection_1_professor_dash' style='display: block'>
					<div class='columns is-mobile is-multiline is-mobile'>
						<div class='column is-full'>
							<p>Algorithms</p>
						</div>
					</div>

					<div class='columns is-mobile is-multiline is-mobile'>
						<div class='column is-half'>
							<span>Group Formation Alg.</span>
						</div>
						<div class='column is-half'>
							<span>Quality Estimation Alg.</span>
						</div>
					</div>
					<div class='columns is-mobile is-multiline is-mobile'>
						<div class='column is-half'>
							<div class='dropdown'>
								<div class='dropdown-trigger'>
									<button class='button' aria-haspopup='true' aria-controls='dropdownMenu1'>
										<span id='selectedGenAlgId_professor_dash'>
											Grouping Alg.
										</span>
										<span class='icon is-small' >
											<i class='fas fa-angle-down' aria-hidden='true'></i>
										</span>
									</button>
								</div>
								<div class='dropdown-menu' id='dropdownMenu1_professor_dash' role='menu' style='height:35em; width:30em; overflow-y:scroll'>
									<div class='dropdown-content'>
										<a class='dropdown-item'>
											Random (no search)
											<div class='form-group columns' style='opacity: 0.8; font-weight:bold;'>
												<div class='column is-1'>
												</div>
												<div class='column'>
													<div>Comp. Efficiency (Scalability)</div>
													<div>Solution Quality</div>
												</div>
												<div class='column'>
													<div>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
													</div>
													<div>
														<i class='fa-regular fa-star'></i>
														<i class='fa-regular fa-star'></i>
														<i class='fa-regular fa-star'></i>
														<i class='fa-regular fa-star'></i>
														<i class='fa-regular fa-star'></i>
													</div>
												</div>
											</div>
										</a>
										<a class='dropdown-item' data-tooltip='See GIMME-API for details'>
											Pure Random Search
											<div class='form-group columns' style='opacity: 0.8; font-weight:bold;'>
												<div class='column is-1'>
												</div>
												<div class='column'>
													<div>Comp. Efficiency (Scalability)</div>
													<div>Solution Quality</div>
												</div>
												<div class='column'>
													<div>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-regular fa-star'></i>
													</div>
													<div>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-regular fa-star'></i>
														<i class='fa-regular fa-star'></i>
													</div>
												</div>
											</div>
											<div>
												<button class='button modal-button is-small is-rounded' data-target="modalPRS_professor_dash">Configure...</button>
											</div>
										</a>
										<!--<a class='dropdown-item' data-tooltip='See GIMME-API for details'>
											Annealed Pure Random Search
											<div class='form-group columns'>
												<div class='column is-1'>
												</div>
												<div class='column'>
													<div>Comp. Efficiency (Scalability)</div>
													<div>Solution Quality</div>
												</div>
												<div class='column'>
													<div>
														N/A
													</div>
													<div>
														N/A
													</div>
												</div>
											</div>
											<div>
												<button class='button modal-button is-small is-rounded' data-target="modalAnnealedPRS_professor_dash">Configure...</button>
											</div>
										</a>-->
										<a class='dropdown-item' data-tooltip='See GIMME-API for details'>
											Evolutionary Search
											<div class='form-group columns' style='opacity: 0.8; font-weight:bold;'>
												<div class='column is-1'>
												</div>
												<div class='column'>
													<div>Comp. Efficiency (Scalability)</div>
													<div>Solution Quality</div>
												</div>
												<div class='column'>
													<div>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-regular fa-star'></i>
													</div>
													<div>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-regular fa-star'></i>
													</div>
												</div>
											</div>
											<div>
												<button class='button modal-button is-small is-rounded' data-target="modalEvolutionary_professor_dash">Configure...</button>
											</div>
										</a>
										<a class='dropdown-item is-active' data-tooltip='See GIMME-API for details'>
											ODPIP Search
											<div class='form-group columns' style='opacity: 0.8; font-weight:bold;'>
												<div class='column is-1'>
												</div>
												<div class='column'>
													<div>Comp. Efficiency (Scalability)</div>
													<div>Solution Quality</div>
												</div>
												<div class='column'>
													<div>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-regular fa-star'></i>
														<i class='fa-regular fa-star'></i>
														<i class='fa-regular fa-star'></i>
													</div>
													<div>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
													</div>
												</div>
											</div>
											<div>
												<button class='button modal-button is-small is-rounded' data-target="modalODPIP_professor_dash">Configure...</button>
											</div>
										</a>
										<a class='dropdown-item' data-tooltip='See GIMME-API for details'>
											Coalition Link Search
											<div class='form-group columns' style='opacity: 0.8; font-weight:bold;'>
												<div class='column is-1'>
												</div>
												<div class='column'>
													<div>Comp. Efficiency (Scalability)</div>
													<div>Solution Quality</div>
												</div>
												<div class='column'>
													<div>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-regular fa-star'></i>
														<i class='fa-regular fa-star'></i>
													</div>
													<div>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-regular fa-star'></i>
													</div>
												</div>
											</div>
										</a>
									</div>
								</div>
							</div>
						</div>



						<div class='column is-half'>
							<div class='dropdown'>
								<div class='dropdown-trigger'>
									<button class='button' aria-haspopup='true' aria-controls='dropdownMenu2'>
										<span id='selectedRegAlgId_professor_dash' >Quality Estimation Alg.</span>
										<span class='icon is-small'>
											<i class='fas fa-angle-down' aria-hidden='true'></i>
										</span>
									</button>
								</div>
								<div class='dropdown-menu' id='dropdownMenu2_professor_dash' role='menu'>
									<div class='dropdown-content'>
										<a class='dropdown-item'>
											K-Nearest-Neighbors (KNN)
											<div class='column'></div>
											
											<div class='form-group columns' style='opacity: 0.8; font-weight:bold;'>
												<div class='column is-1'>
												</div>
												<div class='column'>
													<div>Comp. Efficiency (Scalability)</div>
												</div>
												<div class='column'>
													<div>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-regular fa-star'></i>
														<i class='fa-regular fa-star'></i>
													</div>
												</div>
											</div>
											
											<div class='form-group'>
												<button class='button modal-button is-small is-rounded' data-target="modalKNN_professor_dash">Configure...</button>
											</div>
										</a>
										<!--<a class='dropdown-item'>
											Neural Networks
										</a>
										<a class='dropdown-item'>
											Reinf. Learn.
										</a>-->
										<a class='dropdown-item is-active'>
											KNN w/ Synergy Between Students
											<div class='column'></div>
											
											<div class='form-group columns' style='opacity: 0.8; font-weight:bold;'>
												<div class='column is-1'>
												</div>
												<div class='column'>
													<div>Comp. Efficiency (Scalability)</div>
												</div>
												<div class='column'>
													<div>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-solid fa-star'></i>
														<i class='fa-regular fa-star'></i>
													</div>
												</div>
											</div>
											
											<div class='form-group'>
												<button class='button modal-button is-small is-rounded' id='modalSynergiesConfigButton_professor_dash' data-target='modalSynergies_professor_dash'>Configure...</button>
											</div>
										</a>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>

				<!-- <div class='panel-block' id='additionalAlgorithmsSection_2_professor_dash' style='display: block;'>
					<div class='columns is-mobile is-multiline'>
						<div class='column is-full'>
							<p>Quality Weights</p>
						</div>

						<div class='column is-half'>
							<label class='control-label' for='quantity'>Ability</label>  
							<div class='control'>
								<input id='qualityWeightsAbId_professor_dash' class='input' type='number' step='0.01' min='0' max='1' placeholder='0.50'>
							</div>
						</div>

						<div class='column is-half'>
							<label class='control-label' for='quantity'>Engagement</label>  
							<div class='control'>
								<input id='qualityWeightsEngId_professor_dash' class='input' type='number' step='0.01' min='0' max='1' placeholder='0.50'>
							</div>
						</div>
					</div>
				</div>

				</div> -->
			</div>
		</section>


		<section class='section'>
			<div class='panel animated zoomIn'>
				<div class='panel-heading'>
					<div class='columns is-mobile is-vcentered'>
						<div class='column'>
							Current Adaptation State
							<div class='is-pulled-right'>
								<div class='button minimizerButton'></div>
							</div>
						</div>
					</div>
				</div>
				
				
				<div class='panel-block panel-block-borderless'>
					<div class='columns is-mobile is-fullwidth'>
						<div class='column is-full'>
							<p>Group Organization</p>
						</div>
					</div>
				</div>

				<div class='panel-block panel-block-borderless'>
					<!-- is-fullwidth only occupies a portion of the panel block -->
					<div style="width:100%" class='columns is-mobile has-text-centered'>
						<div class='column is-6 is-offset-1 has-tooltip-top  has-tooltip-arrow' data-tooltip='Loads the parameterization above iff the configuration changed, and computes a new adaptation state.'>
							<button class='button is-fullwidth is-fullheight is-info' id='loadAndStartAdaptation_professor_dash'>Check Setup and Iterate</button>
						</div>
						<div class='column is-3 is-offset-1'>
							<button class='button is-fullwidth is-fullheight' id='rebuildPlot_professor_dash'>Rebuild Plot</button>
						</div>
					</div>
				</div>


				<div class='panel-block panel-block-borderless'>
					<div id='adaptationError_professor_dash' class='section hero is-danger is-centered has-text-centered' style='width:100%'>
						<label class='label subtitle is-4 is-white'>Adaptation Error! Tip: verify if enough students are selected. 
						Maintaining old state...</label>
					</div>
					<div id='adaptationIssues_professor_dash' class='section hero is-warning is-centered has-text-centered' style='width:100%'>
						<label class='label subtitle is-4 is-white'>Adaptation Issues Found: </label>
						<label id='adaptationIssuesText_professor_dash'></label>
					</div>
					<div id='adaptationInfo_professor_dash' class='section hero is-info is-centered has-text-centered' style='width:100%'>
						<label id='adaptationInfoTitle_professor_dash' class='label subtitle is-4 is-white'>Adaptation Info: </label>
						<label id='adaptationInfoText_professor_dash'></label>
					</div>
				</div>

				<div class='panel-block'>
					<div class="columns is-mobile is-centered is-mobile">
						<div class='column is-3'>
							<div id='groupsPlotLegendTrigger_professor_dash'>
								<div class='button has-tooltip-top has-tooltip-arrow' data-tooltip='Show caption.'>
									<i class="fa fa-window-maximize" aria-hidden="true"></i>
								</div>
							</div>
							<div class='has-text-right has-tooltip-top has-tooltip-arrow' id='groupsPlotLegend_professor_dash' data-tooltip='Click on this caption to hide it.'>
								<img src="{% static "media/images/groupPlotLegend.png" %}"></img>
							</div>
						</div>
						<div class='column is-9'>
							<div id='groupsPlot_professor_dash'></div>
						</div>
					</div>

					<div class='columns is-mobile is-centered is-mobile'>
						<img class='column is-2 loading-anim' id='groupsPlotLoadingImage_professor_dash' src="{% static "media/images/loading.gif" %}"></img>
					</div>
				</div>

				<div class='panel-block' style='display: block;'>
					<p>Overall Preferences Distribution</p>
					<div class='columns is-mobile is-centered is-mobile'>
						<div class='column is-7' id='interactionsProfilePlot_professor_dash'></div>
					</div>

					<div class='columns is-mobile is-centered is-mobile'>
						<img class='column is-2 loading-anim' id='interactionsProfilePlotLoadingImage_professor_dash' src="{% static "media/images/loading.gif" %}"></img>
					</div>
				</div>

				<div class='panel-block' style='display: block;'>
					<p>Average Class Learning State</p>
					<div class='columns is-mobile is-centered is-mobile'>
						<div class='column is-7' id='learningStatePlot_professor_dash'></div>
					</div>

					<div class='columns is-mobile is-centered is-mobile'>
						<img class='column is-2 loading-anim' id='learningStatePlotLoadingImage_professor_dash' src="{% static "media/images/loading.gif" %}"></img>
					</div>
				</div>
			</div>
		</section>
		
		
			
			
		
		<!-- modals -->
		<div class="modal" id="modalPRS_professor_dash">
			<div class="modal-background"></div>
			<div class="modal-content">
				<div class="is-size-2">Configuration Options: Pure Random Search</div>
				<div class="column"></div>
				<div class='form-group'>
					<label class='column is-4 control-label' for='textinput'>Num Generated Configurations</label>  
					<div class='control'>
						<input id='numberOfConfigChoicesId_professor_dash' class='input' type='number' min='1' max='1000' placeholder='100'>
					</div>
				</div>
			</div>
			<button class="modal-close is-large" aria-label="close"></button>
		</div>
		
		
		<div class="modal" id="modalAnnealedPRS_professor_dash">
			<div class="modal-background"></div>
			<div class="modal-content">
				<div class="is-size-2">Configuration Options: Annealed Pure Random Search</div>
				<div class="column"></div>
				
				<div class='form-group'>
					<label class='column is-4 control-label' for='textinput'>Num Generated Configurations</label>  
					<div class='control'>
						<input id='numberOfConfigChoicesId_professor_dash' class='input' type='number' min='1' max='1000' placeholder='100'>
					</div>

					<label class='column is-4 control-label' for='textinput'>Temperature Decay</label>  
					<div class='control'>
						<input id='temperatureDecay_professor_dash' class='input' type='number' min='0' max='1' step="0.01" placeholder='0.5'>
					</div>
				</div>
				
			</div>
			<button class="modal-close is-large" aria-label="close"></button>
		</div>
		
		
		<div class="modal" id="modalEvolutionary_professor_dash">
			<div class="modal-background"></div>
			<div class="modal-content">
				<div class="is-size-2">Configuration Options: Evolutionary (Genetic) Search</div>
				<div class="column"></div>
				
				<div class='form-group'>
					<label class='column is-4 control-label' for='textinput'>Initial Population Size</label>  
					<div class='control'>
						<input id='initialPopulationSize_professor_dash' class='input' type='number' min='1' max='1000' placeholder='100'>
					</div>
					
					<label class='column is-4 control-label' for='textinput'>Crossover Prob.</label>  
					<div class='control'>
						<input id='probOfCross_professor_dash' class='input' type='number' min='0' max='1' step="0.01" placeholder='0.65'>
					</div>
					
					<label class='column is-4 control-label' for='textinput'>Mutation Prob.</label>  
					<div class='control'>
						<input id='probOfMutation_professor_dash' class='input' type='number' min='0' max='1' step="0.01" placeholder='0.15'>

						<div class='form-group'>
							<label class='column is-4 control-label' for='textinput'>Config. Change Mutation Prob.</label>  
							<div class='control'>
								<input id='probOfMutationConfig_professor_dash' class='input' type='number' min='0' max='1' step="0.01" placeholder='0.8'>
							</div>
							<label class='column is-4 control-label' for='textinput'>Profile Change Mutation Prob.</label>  
							<div class='control'>
								<input id='probOfMutationGIPs_professor_dash' class='input' type='number' min='0' max='1' step="0.01" placeholder='0.4'>
							</div>
						</div>
					</div>

					<label class='column is-4 control-label' for='textinput'>Num. Evolutions Per Iteration</label>  
					<div class='control'>
						<input id='numberOfEvolutionsPerIteration_professor_dash' class='input' type='number' min='0' max='100' step="1" placeholder='50'>
					</div>

					<label class='column is-4 control-label' for='textinput'>Num. Children Per Generation</label>  
					<div class='control'>
						<input id='numChildrenPerIteration_professor_dash' class='input' type='number' min='0' max='100' step="1" placeholder='100'>
					</div>

					<label class='column is-4 control-label' for='textinput'>Num. Survivors Per Generation</label>  
					<div class='control'>
						<input id='numSurvivors_professor_dash' class='input' type='number' min='0' max='100' step="1" placeholder='10'>
					</div>
				</div>
				
			</div>
			<button class="modal-close is-large" aria-label="close"></button>
		</div>
		
		
		<div class='modal' id='modalODPIP_professor_dash'>
			<div class='modal-background'></div>
			<div class='modal-content'>
				<div class='is-size-2'>Configuration Options: ODPIP Search</div>
				<div class='column'></div>
				
				<div class='subtitle' style='color:gray;'>Constraint Options</div>
				
				<div id='constraintsError_professor_dash' class='section hero is-danger is-centered has-text-centered' style='width:100%'>
					<label class='label subtitle is-4 is-white'>Constraint Creation Error! Please verify if at least two students are selected.</label>
				</div>
				
				<div class='panel-block dash-cell-box has-tooltip-arrow' data-tooltip="To create a constraint, first select two or more students, and then the type of constraint (if they must be joint or separated). Afterwards, click on the '+' button to add the new constraint.">
					<div class='column is-two-thirds'>
						<div class='subtitle is-5 has-tooltip-arrow' style='color:gray;'>Students</div>
						<div class='table-container'>
							<div class='table' style='margin:2em;' id='cstUsersODPIPTable_professor_dash'></div>
						</div>
					</div>
				
					<div class='column'>
						<div class='subtitle is-5 has-tooltip-arrow' style='color:gray;'>Type</div>
						<div class='table-container'>
							<div class='table' style='margin:2em;' id='cstTypeODPIPTable_professor_dash'></div>
						</div>
					</div>
				</div>
				
				<div class='panel-block dash-cell-box'>
					<div class='column'>
						<div class='subtitle is-5 has-tooltip-arrow' style='color:gray;'>Constraints</div>
						<div class='table-container'>
							<div class='table' style='margin:2em;' id='cstODPIPTable_professor_dash'>
							</div>
						</div>
					</div>
				</div>
				
				<!--<div class='form-group'>
					<label class='column is-4 control-label' for='textinput'>Joint Player Constraints</label>  
					<div class='control' data-tooltip='Optional, Format: [id1, id2]; [id3, id4]'>
						<input id='jointPlayerConstraintsId_professor_dash' class='input' type='text'>
					</div>

					<label class='column is-4 control-label' for='textinput'>Separated Player Constraints</label>  
					<div class='control' data-tooltip='Optional, Format: [id1, id2]; [id3, id4]'>
						<input id='separatedPlayerConstraintsId_professor_dash' class='input' type='text'>
					</div>
				</div>-->
			</div>
			
			<button class="modal-close is-large" aria-label="close"></button>
		</div>
		
		
		<div class="modal" id="modalKNN_professor_dash">
			<div class="modal-background"></div>
			
			<div class="modal-content">
				<div class="is-size-2">Configuration Options: KNN</div>
				<div class="column"></div>
				<div class='form-group'>
					<label class='column is-4 control-label' for='textinput'>Num NNs</label>  
					<div class='control'>
						<input  id='numNNsId_professor_dash' class='input' type='number' min='1' max='100' placeholder='5'>
					</div>
				
					<label class='column is-4 control-label' for='textinput'>Ability</label>  
					<div class='control'>
						<input id='qualityWeightsAbId_professor_dash' class='input' type='number' step='0.01' min='0' max='1' placeholder='0.50'>
					</div>
				
					<label class='column is-4 control-label' for='textinput'>Engagement</label>  
					<div class='control'>
						<input id='qualityWeightsEngId_professor_dash' class='input' type='number' step='0.01' min='0' max='1' placeholder='0.50'>
					</div>
				</div>
			</div>
			
			<button class="modal-close is-large" aria-label="close"></button>
		</div>
		
		<div class="modal" id="modalSynergies_professor_dash">
			<div class="modal-background"></div>
			<div class="modal-content">
				<div class="is-size-2">Configuration Options:</div> 
				<div class="is-size-2">KNN w/ Synergy Between Students</div>
			
				<div class='block dash-cell-box has-background-white'>
					<label class='subtitle columns is-4 control-label' style='color:gray;' for='textinput'>KNN Options (for Preferences Est.)</label>  
					<div class='columns'>
						<div class='column is-1'></div>
						<div class="column">
							<label class='column is-4 control-label' for='textinput'>Num NNs</label>  
							<div class='control'>
								<input  id='synergiesNumNNsId_professor_dash' class='input' type='number' min='1' max='100' placeholder='5'>
							</div>
						
							<label class='column is-4 control-label' for='textinput'>Ability</label>  
							<div class='control'>
								<input id='synergiesQualityWeightsAbId_professor_dash' class='input' type='number' step='0.01' min='0' max='1' placeholder='0.50'>
							</div>
						
							<label class='column is-4 control-label' for='textinput'>Engagement</label>  
							<div class='control'>
								<input id='synergiesQualityWeightsEngId_professor_dash' class='input' type='number' step='0.01' min='0' max='1' placeholder='0.50'>
							</div>
						</div>
						<div class='column is-1'></div>
					</div>
				</div>
				
				<div class='block dash-cell-box has-background-white'>
					<label class='subtitle columns is-4 control-label' style='color:gray;' for='textinput'>Synergies Table (for Coalition Eval.)</label>  
					<div class='columns'>
						<div class='column is-1'></div>
						<div class='column form-group has-tooltip has-tooltip-arrow' data-tooltip="This table relates each pair of students' preferences quadrants to a value, which can be modified via a cell click. The higher the value, the better the pair is considered to work together.">
							<div class='control' style='margin: auto' id="modalSynergiesTable_professor_dash"></div>
						</div>
						<div class='column is-1'></div>
					</div>
					
					<div class='columns'>
						<div class='column is-1'></div>
						<button class='column button is-fullwidth is-fullheight is-info' id='modalSynergiesTable-save-button_professor_dash'>Save Table</button>
						<div class='column is-1'></div>
					</div>
				</div>
			</div>
			
			<button class="modal-close is-large" aria-label="close"></button>
			
		</div>
		
		
		
		
		{% csrf_token %}

		
		
		
	</div>
	{% include 'common/footer.html' %}
</body>
<script
src='https://code.jquery.com/jquery-3.2.1.min.js'
integrity='sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4='
crossorigin='anonymous'></script>
<script src='https://d3js.org/d3.v5.js' crossorigin='anonymous'></script>
<script src='https://unpkg.com/d3-force-attract@latest' crossorigin='anonymous'></script>
<!-- <script src='{% static 'js/color.js' %}' crossorigin='anonymous'></script> -->
<script src='{% static 'js/plots.js' %}'></script>

<script>

	$(document).ready(function(){
		
		// CSRF protection setup 
		// (from: 
		// https://docs.djangoproject.com/en/dev/ref/csrf/
		// and https://stackoverflow.com/questions/54835849/django-how-to-send-csrf-token-with-ajax
		// )
		csrftoken = document.querySelector('[name=csrfmiddlewaretoken]').value;
		function csrfSafeMethod(method) {
    		// these HTTP methods do not require CSRF protection
		    return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
		}
		$.ajaxSetup({
		    beforeSend: function(xhr, settings) {
		        if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
		            xhr.setRequestHeader("X-CSRFToken", csrftoken);
		        }
		    }
		});


		buildStatePlot('simulationState_professor_dash', 
				[
					{ "name": "Week" , "value": 3 },
				],
				1,
				10
			);

		$("#adaptationError_professor_dash").hide();
		$("#adaptationIssues_professor_dash").hide();
		$("#adaptationInfo_professor_dash").hide();
		$("#adaptationIssuesText_professor_dash").html('');

		$("#constraintsError_professor_dash").hide();

				
		var currServerState = {};
		var currAdaptationConfig = {
							'selectedGenAlgId': '',
							'selectedRegAlgId': '',
							
							'numNNs': '',

							'synergiesNumNNs': '',
							'synergiesQualityWeightsAb': '',
							'synergiesQualityWeightsEng': '',

							// 'minNumberOfPlayersPerGroup': '',
							// 'maxNumberOfPlayersPerGroup': '',
							'preferredNumberOfPlayersPerGroup': '',
							'qualityWeightsAb': '',
							'qualityWeightsEng': '',
							'playerWindow': '',

							'numberOfConfigChoices': '',

							'temperatureDecay': '',

							'initialPopulationSize': '',
							'probOfCross': '',
							'probOfMutation': '',
							'probOfMutationConfig': '',
							'probOfMutationGIPs': '',
							'numberOfEvolutionsPerIteration': '',
							'numChildrenPerIteration': '',
							'numSurvivors': '',



							'isBootstrapped': '',
							'numBootstrapIterations': ''
						};


		// special button effects
		$('#qualityWeightsAb_professor_dash').change(function(){
			$('#qualityWeightsEng_professor_dash').val(1.0 - $(this).val())
		});
		$('#qualityWeightsEng_professor_dash').change(function(){
			$('#qualityWeightsAb_professor_dash').val(1.0 - $(this).val())
		});
		
		simulationWeekMessages = ["Create and register the tasks for the course. Share the platform link with the students, so they can sign up in the platform.",
									"Select all students that will be considered when forming the groups. Select all tasks relating to week 1. Do an iteration of the algorithm and verify the formed groups. Evaluate Student_E and simulate evaluation for the rest.",
									"Student_A will not be available this week, remove them from the selection. Select week 2's tasks. Iterate and simulate reaction.",
									"Student_X cannot be in the same group as Student_Y, create the restriction so that Student_X and Student_Y are separated. Student_Y was misevaluated from last week, correct their ability value. Iterate and simulate reaction.",
									"Student_Y was very engaged in the group project when working with Student_Z, create the restriction so that Student_Y and Student_Z are put together. Iterate and simulate reaction.",
									"From this week onward, the course will accept new students from similar courses. Select the most appropriate grouping method to generate the groups for this week. Iterate and simulate reaction."]


		dropdownItemsText = [["<a class=\'dropdown-item\'> Share link </a>","<a class=\'dropdown-item\'> Simulate task registration </a>"], ["<a class=\'dropdown-item\'> Simulate evaluation of students </a>"], ["<div class=\'dropdown-item\'> No actions available </div>"], ["<div class=\'dropdown-item\'> No actions available </div>"], ["<div class=\'dropdown-item\'> No actions available </div>"], ["<div class=\'dropdown-item\'> No actions available </div>"]];
		dropdownItemsUrls = [['/shareLinkSim/', '/taskRegistrationSim/'], ['/evaluateSim/'], [],[],[],[]]
		var changeSimulationWeek = function(newServerState)
		{
			week = newServerState.simWeek
			console.log(week)
			
			if (week == 1){
				console.log(simulationWeekMessages[week].replace("Student_E", newServerState.studentToEvaluate))
				simulationWeekMessages[week] = simulationWeekMessages[week].replace("Student_E", newServerState.studentToEvaluate)
			}	

			if (week == 2){
				console.log(newServerState.unavailableStudent)
				simulationWeekMessages[week] = simulationWeekMessages[week].replace("Student_A", newServerState.unavailableStudent)
			}

			if (week == 3){
				simulationWeekMessages[week] = simulationWeekMessages[week].replaceAll("Student_X", newServerState.studentX)
				simulationWeekMessages[week] = simulationWeekMessages[week].replaceAll("Student_Y", newServerState.studentY)
			}

			if (week == 4){
				simulationWeekMessages[week] = simulationWeekMessages[week].replaceAll("Student_Y", newServerState.studentY)
				simulationWeekMessages[week] = simulationWeekMessages[week].replaceAll("Student_Z", newServerState.studentZ)
			}
		
			var simulationLog = $("<div class=\'list\'> </div>");
			for (var i = 0; i <= week; i++){
				simulationLog.append("<div class=\'list-item\'>" + simulationWeekMessages[i] + "</div>");
				simulationLog.show(135)
			}
			return simulationLog;
		}

		var changeSimulationDropdownActions = function(week)
		{
			var simulationDropdown = $("<div class=\'dropdown-menu\' role=\'menu\' style=\"height:5em; width:10em; overflow-y:scroll; display:block\"> </div>");
			var simulationDropdownContent = $("<div class=\'dropdown-content\'> </div>");
			for (var i = 0; i < dropdownItemsText[week].length; i++) {
				var dropdownItem = $(dropdownItemsText[week][i]);
				simulationDropdownContent.append(dropdownItem);
				if (dropdownItemsText[week][i] == "<a class=\'dropdown-item\'> Share link </a>") {
					dropdownItem.click(function(){
						$.ajax(
						{
							type: 'POST',
							url: '/shareLinkSim/',
							data: {"numUsersToGenerate": 20, "minDelay": 1, "maxDelay": 5}
						}
						);
					});
				}
				else if (dropdownItemsText[week][i] == "<a class=\'dropdown-item\'> Simulate task registration </a>") {
					dropdownItem.click(function(){
						$.ajax(
						{
							type: 'POST',
							url: '/taskRegistrationSim/'
						}
						);
					});
				}
				else if (dropdownItemsText[week][i] == "<a class=\'dropdown-item\'> Simulate evaluation of students </a>") {
					dropdownItem.click(function(){
						$.ajax(
						{
							type: 'POST',
							url: '/evaluateSim/'
						}
						);
					});
				}
			}
			simulationDropdown.append(simulationDropdownContent);
			return simulationDropdown;
		}
	
		var canComputeAdaptation = function(newServerState){
			return !(JSON.stringify(currServerState) === JSON.stringify(newServerState));
		}
		
		
		
		
		//synergy tables stuff
		var addSynergyTableLine = function(line, domTable, colElems, isRemovable){
			var rowContent = $('<div class=\'row columns is-variable\'></div>');
			if(isRemovable){
				var removeButton = $(`
				<div class=\'column is-1 button is-danger\'>
					<i class="fa fa-trash" aria-hidden="true"></i>
				</div>
				`);
				rowContent.append(removeButton);
				removeButton.click(function(){
					($(this)).parent().hide(500, function(){ ($(this)).remove(); });
				});
			}
			else{
// 				rowContent.append($("<div class=\'column is-1 \'></div>"));
				rowContent.append($("<div></div>"));
			}
			for(var col=0; col<colElems.length; col++){
				id = "table_"+col+"_"+line;
				
				var textInputBox = $("<input class=\'column button is-white\'/>").attr({
					type: "text", id: id, name: id
				});
				
				
				lineElem = colElems[col];
					
				if(line == 0 || col < 2){
					textInputBox.addClass("is-light")
					textInputBox.attr("readonly", "readonly");
					textInputBox.attr("background-color", "gray");
				}
				
				textInputBox.val(lineElem);
				rowContent.append(textInputBox);
			}
			rowContent.hide();
			domTable.append(rowContent);
			rowContent.show(500);
		}
		
		var sngTableStrToDom = function(sngTbl, domTable){
			
			sngTbl = sngTbl.replaceAll('\t','');
			sngTbl = sngTbl.split("\n");
			var structuredSngTbl = [];
			for(var i=0; i<sngTbl.length; i++){
				var item = sngTbl[i];
				structuredSngTbl.push(item.split(','));
			}
			
			var table = $('<div class=\'column\'></div>');
			for(var line=0; line<structuredSngTbl.length; line++){
				var colElems = undefined;
				colElems = structuredSngTbl[line];	
// 				addSynergyTableLine(line, table, colElems, line > 0);
				addSynergyTableLine(line, table, colElems, false);
			}
			domTable.append(table);
			
			
// 			var addLineButtonRow = $('<div class=\'column columns is-variable\'></div>');
// 			domTable.append(addLineButtonRow);
// 			colElems = new Array(structuredSngTbl[0].length).fill("<NA>");
// 			var addLineButton = $(`<button class=\'column is-1 button is-info\'>
// 				<i class="fas fa-plus-circle" aria-hidden="true"></i>
// 			</button>`).attr({
// 				type: "text", id: id, name: id
// 			});
// 			addLineButton.click(function(){
// 				var lineDoms = $(domTable.children()[0]).children();
// 				addSynergyTableLine(lineDoms.length, table, colElems, true);
// 			});
// 			addLineButtonRow.append(addLineButton);
		}
		
		var sngTableDomToStr = function(domTable){
			var lineDoms = $(domTable.children()[0]).children();
			var retStr = "";
			for(var line=0; line<lineDoms.length; line++){
				var colDoms = $(lineDoms[line]).children();
				for(var col=1;col<colDoms.length; col++){
					colStr = $(colDoms[col]).val();
					retStr +=  (col < (colDoms.length) - 1)? colStr+",": 
						(line < (lineDoms.length) - 1)? colStr+"\n": colStr; 
				}
			}
			return retStr;
			
		}
		
		
		var generateSynergiesTableFromFile = function(){
			$.ajax(
				{
					type: 'POST',
					url: '/fetchSynergiesTable/',
					dataType: 'json',
					success: 
						function(response) {
							var textualTbl = response['textualTbl'];
							$('#modalSynergiesTable_professor_dash').empty();
							sngTableStrToDom(textualTbl, $('#modalSynergiesTable_professor_dash'));
						}
				}
			);
		};

		$('#modalSynergiesTable-save-button_professor_dash').click(function(){
			$.ajax(
				{
					type: 'POST',
					url: '/saveSynergiesTable/',
					dataType: 'json',
					data: {'textualTbl': sngTableDomToStr($('#modalSynergiesTable_professor_dash'))}
				}
			);
		});
		
		$('#modalSynergiesConfigButton_professor_dash').click(function(){
			generateSynergiesTableFromFile();
		});


		
		
		
		var usersSelectedDOMElems = [];
		var currCstTypeDOMElem = undefined;
		var currCsts = { 'joint': [], 'separated': [] };
		
		var processCstArray = function(cst){
			return JSON.stringify(cst)
				.replace('[[','[')
				.replace(']]',']')
				.replaceAll('],[','];[');
		};
		
		var processedCsts = function(currCstr){
			return { 'joint': processCstArray(currCstr['joint']), 'separated': processCstArray(currCstr['separated']) };
		};
		
		
		var generateODPIPUsrTableFromArray = function(idArray, tagClass, highlightedTagClass){
		    var table = $('<div></div>');
		    for(var i=0; i < idArray.length; i++){
		        
		        var tag = $("<span class='context-menu' style='margin:0.1em; z-index:1000;'></span>").text(idArray[i]);
		        tag.click(function(){
					if($(this).hasClass(tagClass)){
						$(this).removeClass(tagClass);
						$(this).addClass(highlightedTagClass);
						usersSelectedDOMElems.push($(this))
					}else{
						$(this).addClass(tagClass);
						$(this).removeClass(highlightedTagClass);
						usersSelectedDOMElems.splice(
							usersSelectedDOMElems.indexOf($(this))
						, 1);
					}
		        })
		        
		        tag.attr('tagClass',tagClass);
		        tag.attr('highlightedTagClass',highlightedTagClass);
				tag.attr('elemID', idArray[i]);
				tag.addClass('tag');
				tag.addClass(tagClass);
				tag.addClass('is-medium');
				tag.addClass('is-rounded');
				table.append(tag);
				tag.show(135);
		    }
		    return table;
		};
		var generateODPIPTypeTableFromArray = function(tagClass, highlightedTagClass){
		    var table = $('<div></div>');
		    var elemArray = [
				`<i class="fa-solid fa-people-group" data-tooltip="Students must be joint."></i>`,
				`<i class="fa-solid fa-people-arrows-left-right" data-tooltip="Students must be separated."></i>`
		    ];
		    for(var i=0; i < elemArray.length; i++){
		        var tag = $("<span class='context-menu' style='margin:0.1em; z-index:1000;'></span>")
		        tag.append(elemArray[i]);
		        
		        tag.attr('cstType', (i==0)? 'joint': 'separated');
		        tag.attr('tagClass',tagClass);
		        tag.attr('highlightedTagClass',highlightedTagClass);
		        tag.click(function(){
					var buttons = $($(this).parent()).children();
					for(var j=0; j< buttons.length; j++){
						var currElem = buttons[j];
						$(currElem).removeClass(highlightedTagClass);
					}
					$(this).addClass(highlightedTagClass);
					currCstTypeDOMElem = $(this);
		        })
		        
				tag.addClass('tag');
				tag.addClass((i==0)? highlightedTagClass: tagClass);
				tag.addClass('is-medium');
				tag.addClass('is-rounded');
				table.append(tag);
				tag.show(135);
				
				if(i==0){
					currCstTypeDOMElem = tag;
				}
		    }
		    return table;
		};
		
		var appendCstTag = function(tagClass, usersSelectedForConstraint, currConstraintType, jointTable, sepTable){
			
			var csTag = $("<span class='context-menu' style='margin:0.1em; z-index:1000;'></span>");
			csTag.attr('cstType', currConstraintType);
			
			var tagArray = [
				`<i class="fa-solid fa-people-group"></i>`,
				`<i class="fa-solid fa-people-arrows-left-right"></i>`
			];
			
			csTag.append(tagArray[(currConstraintType == 'joint')? 0: 1]);
			csTag.append("<p>&nbsp;&nbsp;"+usersSelectedForConstraint+"</p>");
			csTag.attr('elemID', usersSelectedForConstraint);
			csTag.addClass('tag');
			csTag.addClass(tagClass);
			csTag.addClass('is-medium');
			csTag.addClass('is-rounded');
			
			if(currConstraintType == 'joint'){
				$('#jointCstODPIPTable_professor_dash').append(csTag);
			}else if(currConstraintType == 'separated'){
				$('#separatedCstODPIPTable_professor_dash').append(csTag);
			}
			
			csTag.show(135);
			
			var deleteButton = $('<button style=\'border: none; background-color:transparent; color:white\' class=\'button pointer\'><i class=\'fas fa-trash\'></i></button>');
			deleteButton.click(function(){
				var cstDOMElem = $(this).parent();
				var cstArray = currCsts[$(cstDOMElem).attr('cstType')];
				
				var index = $(cstDOMElem).index();
				
				cstArray.splice(index, 1);
				$(cstDOMElem).remove();
			});
			csTag.append(deleteButton);
			
			
			csTag.attr('elemID', i);
			csTag.addClass('tag');
			csTag.addClass(tagClass);
			csTag.addClass('is-medium');
			csTag.addClass('is-rounded');
			if(currConstraintType == 'joint'){
				$(jointTable).append(csTag);
			}else if(currConstraintType == 'separated'){
				$(sepTable).append(csTag);
			}
			csTag.show(135);
			return csTag
		}
		
		var generateODPIPCstTableFromArray = function(cstArray, tagClass){
		    var table = $(`<div></div>`);
		    
		    var jointTable = $(`<div class='table' style='margin:2em;' id='jointCstODPIPTable_professor_dash'></div>`);
		    var sepTable = $(`<div class='table' style='margin:2em;' id='separatedCstODPIPTable_professor_dash'></div>`);
		    var addButtonTable = $(`<div class='table' style='margin:2em;' id='addCstODPIPTable_professor_dash'></div>`);
		    
		    table.append(jointTable);
		    table.append(sepTable);
		    table.append(addButtonTable);
		    
		    var allCst = cstArray['joint'].concat(cstArray['separated']);
		    for(var i=0; i < allCst.length+1; i++){
		        var tag = undefined;
		        if(i < allCst.length){
					var currConstraintType = (i < cstArray['joint'].length)? 'joint': 'separated';
					appendCstTag(tagClass, allCst[i], currConstraintType, jointTable, sepTable);
		        }else{
					tag = $("<span class='context-menu' style='margin:0.1em; z-index:1000;'></span>").text(allCst[i]);
					var addButton = $("<div class='button is-rounded is-small pointer has-tooltip-arrow' style='color:white; background-color:transparent; margin:0.5em;' data-tooltip='Create constraint.'></div>");
					addButton.append('<button style=\'border: none; background-color:transparent; color:white\' class=\'button pointer\'><i class=\'fas fa-plus-circle\'></i></button>');
					addButton.click(function(){
						
						if(usersSelectedDOMElems.length < 2){
							$('#constraintsError_professor_dash').show(500);
							setTimeout(function(){ $('#constraintsError_professor_dash').hide(500); }, 5000);
							
							return;
						}
						
						var usersSelectedForConstraint = [];
						for(var u=0; u<usersSelectedDOMElems.length; u++){
							var currElem = usersSelectedDOMElems[u];
							usersSelectedForConstraint.push(currElem.text());
							$(currElem).removeClass(currElem.attr('highlightedTagClass'));
							$(currElem).addClass(currElem.attr('tagClass'));
						}
						
						var currConstraintType = $(currCstTypeDOMElem).attr('cstType');
						currCsts[currConstraintType].push(usersSelectedForConstraint);

						appendCstTag(tagClass, usersSelectedForConstraint, currConstraintType, jointTable, sepTable);
						
						usersSelectedDOMElems = [];
						currConstraintType = 'joint';
					});
					tag.append(addButton);
					
					tag.attr('elemID', i);
			        tag.addClass('tag');
			        tag.addClass(tagClass);
			        tag.addClass('is-medium');
			        tag.addClass('is-rounded');
					$(addButtonTable).append(tag);
			        tag.show(135);
		        }
		    }
		    return table;
		};


		
		
		var generateDashTableFromArray = function(canAdd, idArray, nameArray, tagClass, moveButtonIconClass, moveElementUrl, moveElementArg, addElementURL, addElementArg, deleteElementUrl, deleteElementArg, editElementUrl, editElementArg){
		    var table = $('<div></div>');
		    for(var i=0; i < idArray.length+1; i++){
		        
		        var tag = undefined;
		        if(!canAdd && i == idArray.length){
		            return table;
		        }
		        if(i<idArray.length){
		        	tag = $("<span class='context-menu' style='margin:0.1em; z-index:1000;'></span>").text(nameArray[i]);
		        	tag.append("<br></br>")
		        	if(deleteElementUrl!=""){
			            var deleteButton = $("<div class='button is-rounded is-small has-tooltip-arrow' style='color:white; background-color:transparent; margin:0.5em;' data-tooltip='Delete this task'></div>");
			            deleteButton.append('<form method=\'GET\' action=\''+deleteElementUrl+'\'>{% csrf_token %}<input type=\'hidden\' name=\''+deleteElementArg+'\' value=\''+idArray[i]+'\'></input><button type=\'submit\' style=\'border: none; background-color:transparent; color:white\' class=\'button pointer\'><i class=\'fas fa-trash pointer\'></i></button></form>');
			            tag.append(deleteButton);
		            }

		        	if(editElementUrl!=""){
			            var editButton = $("<div class='button is-rounded is-small has-tooltip-arrow' style='color:white; background-color:transparent; margin:0.5em;' data-tooltip='Manually edit state'></div>");
			            editButton.append('<form method=\'GET\' action=\''+editElementUrl+'\'><input type=\'hidden\' name=\''+editElementArg+'\' value=\''+idArray[i]+'\'></input><button type=\'submit\' style=\'border: none; background-color: transparent; color:white\' class=\'button pointer\'><i class=\'fas fa-edit pointer\'></i></button></form>');
			            tag.append(editButton);
					}

		        	if(moveElementUrl!=""){
			            var moveButton = $("<div class='button is-rounded is-small pointer' style='color:white; background-color:transparent; margin:0.5em;' data-tooltip='Select/Deselect this student/task for the next iteration'></div>");
			            moveButton.append("<i class='fas "+moveButtonIconClass+" pointer'></i>");
			            moveButton.click(function() {
			                var data = {};
			                data[moveElementArg] = $($(this)[0].parentElement).attr("elemID");
			                $.ajax({
			                    url: moveElementUrl,
			                    type: 'POST',
			                    data: data            
			                });
			            })
			            tag.append(moveButton);
					}

		        }else{
		        	if(addElementURL!=""){
		        		var addButton = $("<div class='button is-rounded is-small pointer has-tooltip-arrow' style='color:white; background-color:transparent; margin:0.5em;' data-tooltip='Add new task'></div>");
			            addButton.append('<form method="POST" action=\''+addElementURL+'\'>{% csrf_token %}<input type=\'hidden\' name=\''+addElementArg+'\' value=\''+idArray[i]+'\'></input><button type=\'submit\' style=\'border: none; background-color: transparent; color:white\' class=\'button pointer\'><i class=\'fas fa-plus-circle\'></i></button></form>');
		        	
		        		tag = $("<span class='context-menu' style='margin:0.1em; z-index:1000;'>").text(nameArray[i]);
			            tag.append(addButton);
		        	}
		        }

		        if(tag != undefined){
			        tag.attr('elemID', idArray[i]);
			        tag.addClass('tag');
			        tag.addClass(tagClass);
			        tag.addClass('is-medium');
			        tag.addClass('is-rounded');
			        table.append(tag);
			        tag.show(135);
			    }
		    }
		    return table;
		};


		

		var fetchServerData = function(){
			$.ajax(
			{
				url: '/fetchServerState/',
				dataType: 'json',
				success: 
					function (newServerState) {	
						
						//this has to be computed before, 
						//for the case that some student altered their state
						$.ajax({
							type: 'POST',
							url: '/fetchStudentStates/',
							success: 
							function(studentsStates)
							{
								newServerState.studentsStates = JSON.parse(studentsStates);
								
								if(currServerState!={} && 
									studentsStates != undefined && 
									!canComputeAdaptation(newServerState)){
									return;
								}
								readyForNewActivity = newServerState.readyForNewActivity;
								if(readyForNewActivity){

									$('#adaptationInfo_professor_dash').hide(500); 

									$('#forceStartAdaptation_professor_dash').removeClass('is-loading');
									$('#loadAndStartAdaptation_professor_dash').removeClass('is-loading');
									$('#rebuildPlot_professor_dash').removeClass('is-loading');
									
									$('#groupsPlotLegend_professor_dash').show(500);
									$('#groupsPlot_professor_dash').show();
									$('#interactionsProfilePlot_professor_dash').show();
									$('#learningStatePlot_professor_dash').show();
									
									$('#groupsPlotLoadingImage_professor_dash').hide(500);
									$('#interactionsProfilePlotLoadingImage_professor_dash').hide(500);
									$('#learningStatePlotLoadingImage_professor_dash').hide(500);

								}else{
									
									$('#adaptationInfoTitle_professor_dash').html('<br></br>Watch out, it is Big Brain Time!');
									$('#adaptationInfoText_professor_dash').html('<br></br>Please wait some moments until groups are organized according to the students\' preferences...');
									$('#adaptationInfo_professor_dash').show(500);


									$('#rebuildPlot_professor_dash').addClass('is-loading');
									$('#forceStartAdaptation_professor_dash').addClass('is-loading');
									$('#loadAndStartAdaptation_professor_dash').addClass('is-loading');

									$('#groupsPlotLegend_professor_dash').hide(500);
									$('#groupsPlot_professor_dash').hide(500);
									$('#interactionsProfilePlot_professor_dash').hide(500);
									$('#learningStatePlot_professor_dash').hide(500);
									
									$('#groupsPlotLoadingImage_professor_dash').show(500);
									$('#interactionsProfilePlotLoadingImage_professor_dash').show(500);
									$('#learningStatePlotLoadingImage_professor_dash').show(500);

								}

								$('#groupsPlotLegendTrigger_professor_dash').hide();
								$('#groupsPlotLegend_professor_dash').click(function(){
										$('#groupsPlotLegend_professor_dash').hide(500);
										$('#groupsPlotLegendTrigger_professor_dash').show(500);
								});
								$('#groupsPlotLegendTrigger_professor_dash').click(function(){
										$('#groupsPlotLegend_professor_dash').show(500);
										$('#groupsPlotLegendTrigger_professor_dash').hide(500);
								});

								$('#simulationLog_professor_dash').empty();
								$('#simulationLog_professor_dash').append(changeSimulationWeek(newServerState));

								$('#simulationAction_professor_dash').empty();
								$('#simulationAction_professor_dash').append(changeSimulationDropdownActions(newServerState.simWeek));

								var currSelectedUsers = newServerState.currSelectedUsers;
								var currFreeUsers = newServerState.currFreeUsers;
								var fuTable = generateDashTableFromArray(
										true, currFreeUsers, currFreeUsers, 'is-info', 'fa-arrow-circle-right', 
										'{% url 'addSelectedUser' %}', 'username',
										'', 'username',
										'','usernameToDelete',
										'{% url 'manuallyManageStudent' %}','usernameToUpdate'
									);
								var suTable = generateDashTableFromArray(
										false, currSelectedUsers, currSelectedUsers, 'is-info', 'fa-arrow-circle-left', 
										'{% url 'removeSelectedUser' %}', 'username',
										'', 'username',
										'','usernameToDelete',
										'{% url 'manuallyManageStudent' %}','usernameToUpdate'
									);
								$('#freeUsersTable_professor_dash').empty();
								$('#freeUsersTable_professor_dash').append(fuTable);

								$('#selectedUsersTable_professor_dash').empty();
								$('#selectedUsersTable_professor_dash').append(suTable);

								
								
								
								var odpipUsrTable = generateODPIPUsrTableFromArray(
												currSelectedUsers, 'is-white', 'is-info'
											);
								$('#cstUsersODPIPTable_professor_dash').empty();
								$('#cstUsersODPIPTable_professor_dash').append(odpipUsrTable);
								
								var odpipTypeTable = generateODPIPTypeTableFromArray(
												'is-white', 'is-info'
											);
								$('#cstTypeODPIPTable_professor_dash').empty();
								$('#cstTypeODPIPTable_professor_dash').append(odpipTypeTable);
									
								
								$('#cstODPIPTable_professor_dash').empty();
								usersSelectedDOMElems = [];
								currConstraintType = 'joint';
								var odpipCstTable = generateODPIPCstTableFromArray(
												currCsts, 'is-info'
											);
								$('#cstODPIPTable_professor_dash').append(odpipCstTable);
								
								
								console.log(newServerState.currFreeTasks)
								
								var currFreeTasks = unformattedStringToObj(newServerState.currFreeTasks);
								var currSelectedTasks = unformattedStringToObj(newServerState.currSelectedTasks);
								

								var currFreeTaskIds = [];
								var currSelectedTaskIds = [];

								for (i=0; i< currFreeTasks.length; i++){
									currFreeTaskIds[i] = currFreeTasks[i].taskId;
								}
								for (i=0; i< currSelectedTasks.length; i++){
									currSelectedTaskIds[i] = currSelectedTasks[i].taskId;
								}

								ftTable = generateDashTableFromArray(
									true, currFreeTaskIds, currFreeTaskIds, 'is-danger', 'fa-arrow-circle-right', 
									'{% url 'addSelectedTask' %}', 'taskId',
									'{% url 'taskRegistration' %}', 'taskId',
									'{% url 'taskDeletion' %}','taskIdToDelete',
									'{% url 'taskUpdate' %}','taskIdToUpdate'
								);

								stTable = generateDashTableFromArray(
									false, currSelectedTaskIds, currSelectedTaskIds, 'is-danger', 'fa-arrow-circle-left', 
									'{% url 'removeSelectedTask' %}', 'taskId',
									'{% url 'taskRegistration' %}', 'taskId',
									'{% url 'taskDeletion' %}','taskIdToDelete',
									'{% url 'taskUpdate' %}','taskIdToUpdate'
								);

								$('#freeTasksTable_professor_dash').empty();
								$('#freeTasksTable_professor_dash').append(ftTable);

								$('#selectedTasksTable_professor_dash').empty();
								$('#selectedTasksTable_professor_dash').append(stTable);

								newServerState.studentsStates = JSON.parse(studentsStates);
								currServerState = newServerState;

								
								$('#groupsPlot_professor_dash').empty();
								
								if (currServerState.currAdaptationState != [])
									buildPlots(currServerState);
								
								
							}
						});
					}
			}
		);
		};

		fetchServerData();
		setInterval(fetchServerData, 1000);


		var buildPlots = function(currServerState){
			buildGroupsPlot(false, 'groupsPlot_professor_dash', currServerState.currAdaptationState, currServerState.studentsStates);

			$('#interactionsProfilePlot_professor_dash').empty()
			$('#learningStatePlot_professor_dash').empty()
			var interactionDatapoints = [];
			var avgChars = [0,0];

			var profiles = currServerState.currAdaptationState.profiles;
			var avgCharacteristicsPerGroup = currServerState.currAdaptationState.avgCharacteristics;
			for(var i=0; i<profiles.length; i++){
				var currProfile = profiles[i];
				var currState = avgCharacteristicsPerGroup[i]
				interactionDatapoints[i] = { 
					"ID": i, 
					"focus": currProfile.dimensions.Focus*6.0-3.0, 
					"challenge": currProfile.dimensions.Challenge*6.0-3.0, 
					"timestamp": 1 
				};

				avgChars[0] += currState.ability/ profiles.length;
				avgChars[1] += currState.engagement/ profiles.length;
			}


			// interactionDatapoints = [
			// 	{ 'focus': -3 , 'challenge': -3, 'timestamp': 2 },
			// 	{ 'focus': 3, 'challenge': 3, 'timestamp': 1 },
			// 	{ 'focus': 3 , 'challenge': -3, 'timestamp': 4 },
			// 	{ 'focus': -3, 'challenge': 3, 'timestamp': 8 },

			// 	{ 'focus': 1, 'challenge': -3, 'timestamp': 2 },
			// 	{ 'focus': -1, 'challenge': -3, 'timestamp': 1 },
			// 	{ 'focus': -3, 'challenge': 1, 'timestamp': 4 },
			// 	{ 'focus': -3, 'challenge': -1, 'timestamp': 8 }
			// ]

			buildScatterInteractionPlot('interactionsProfilePlot_professor_dash', interactionDatapoints);
			buildStatePlot('learningStatePlot_professor_dash', 
				[
					{ "name": "Ability" , "value": avgChars[0] },
					{ "name": "Engagement" , "value": avgChars[1] }
				]
			);
		}

		var startAdaptation = function(){
			$.ajax(
				{
					url: '/startAdaptation/',
					dataType: 'json',
					complete:
					function(newServerState){
						// $('#loadAndStartAdaptation_professor_dash').removeClass("is-loading");
						// $('#forceStartAdaptation_professor_dash').removeClass("is-loading");

						$('#groupsPlot_professor_dash').empty();
						console.log(newServerState);
						if(newServerState.responseText.localeCompare("error")==0){
							$('#adaptationError_professor_dash').show(500);
							setTimeout(function(){ $('#adaptationError_professor_dash').hide(500); }, 5000);
							currServerState = "error";
							return;
						}

						$("#adaptationError_professor_dash").hide();
						currServerState = newServerState;
					}
				}
			);
		}


		var loadAndStartAdaptation = function(){
			
			var processedCtrs = processedCsts(currCsts)
			
			newAdaptationConfig = {
				'selectedGenAlgId': $('#selectedGenAlgId_professor_dash').text(), 
				'selectedRegAlgId': $('#selectedRegAlgId_professor_dash').text(),


				'numNNs': $('#numNNsId_professor_dash').val(),
				
				'synergiesNumNNs': $('#synergiesNumNNsId_professor_dash').val(),
				'synergiesQualityWeightsAb': $('#synergiesQualityWeightsAbId_professor_dash').val(),
				'synergiesQualityWeightsEng': $('#synergiesQualityWeightsEngId_professor_dash').val(),
				
				// 'minNumberOfPlayersPerGroup': $('#minNumberOfPlayersPerGroupId_professor_dash').val(),
				// 'maxNumberOfPlayersPerGroup': $('#maxNumberOfPlayersPerGroupId_professor_dash').val(),
				'preferredNumberOfPlayersPerGroup': $('#preferredNumberOfPlayersPerGroupId_professor_dash').val(),
				'qualityWeightsAb': $('#qualityWeightsAbId_professor_dash').val(),
				'qualityWeightsEng': $('#qualityWeightsEngId_professor_dash').val(),
				'playerWindow': $('#playerWindowId_professor_dash').val(),

				'numberOfConfigChoices': $('#numberOfConfigChoicesId_professor_dash').val(),

				'temperatureDecay': $('#temperatureDecay_professor_dash').val(),

				'initialPopulationSize': $('#initialPopulationSize_professor_dash').val(),
				'probOfCross': $('#probOfCross_professor_dash').val(),
				'probOfMutation': $('#probOfMutation_professor_dash').val(),
				'probOfMutationConfig': $('#probOfMutationConfig_professor_dash').val(),
				'probOfMutationGIPs': $('#probOfMutationGIPs_professor_dash').val(),
				'numberOfEvolutionsPerIteration': $('#numberOfEvolutionsPerIteration_professor_dash').val(),
				'numChildrenPerIteration': $('#numChildrenPerIteration_professor_dash').val(),
				'numSurvivors': $('#numSurvivors_professor_dash').val(),
				
				'jointPlayerConstraints': processedCtrs['joint'],
				'separatedPlayerConstraints': processedCtrs['separated'],



				'isBootstrapped': $('#precomputeBootstrapId_professor_dash').prop("checked"),
				'numBootstrapIterations': $('#numBootstrapIterationsId_professor_dash').val()
			};
			currAdaptationConfig = newAdaptationConfig;
			$.ajax(
				{
					url: '/configAdaptation/',
					type: 'POST',
					dataType: 'json',
					data: newAdaptationConfig,
					complete: 
					function () {
						startAdaptation();
					}
				}
			);
		}



		// this tab starts hidden
		var additionalTab = $('#additionalAdaptMinimizerButton_professor_dash');
		$('#additionalAlgorithmsSection_1_professor_dash').hide(0);
		$('#additionalAlgorithmsSection_2_professor_dash').hide(0);
		additionalTab.empty().append("<i class=\"fa fa-window-maximize\"></i>");


		$('#loadAndStartAdaptation_professor_dash').click(function(){
			$('#loadAndStartAdaptation_professor_dash').addClass("is-loading");
			loadAndStartAdaptation();
		})
		$('#forceStartAdaptation_professor_dash').click(function(){
			$('#forceStartAdaptation_professor_dash').addClass("is-loading");
			startAdaptation();
		})
		$('#addAllUsers_professor_dash').click(function(){
			$.ajax(
			{
				type: 'POST',
				url: '/addAllUsersSelected/'
			}
			);
		})
		$('#clearAllUsers_professor_dash').click(function(){
			$.ajax(
			{

				type: 'POST',
				url: '/removeAllUsersSelected/'
			}
			);
		})
		$('#addAllTasks_professor_dash').click(function(){
			$.ajax(
			{

				type: 'POST',
				url: '/addAllTasksSelected/'
			}
			);
		})
		$('#clearAllTasks_professor_dash').click(function(){
			$.ajax(
			{
				type: 'POST',
				url: '/removeAllTasksSelected/'
			}
			);
		})
		$('#addSpecificPlayer_professor_dash').click(function(){
			startAdaptation();
		}).hide()

		$('#rebuildPlot_professor_dash').click(function(){
			$('#groupsPlot_professor_dash').empty();
			if(currServerState.currAdaptationState != undefined && currServerState.currAdaptationState.groups != undefined){
				buildGroupsPlot(false, 'groupsPlot_professor_dash', currServerState.currAdaptationState, currServerState.studentsStates);
			}
		})

		$('#advanceSimulationButton_professor_dash').click(function(){
			$.ajax(
			{
				type: 'POST',
				url: '/advanceSimWeek/'
			}
			);
		});

		$('#resetSimulationButton_professor_dash').click(function(){
			$.ajax(
			{
				type: 'POST',
				url: '/resetSimWeek/'
			}
			);
		});

	});
	


</script>
</html>
